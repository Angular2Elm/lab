<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<script src='http://a.tbcdn.cn/s/kissy/1.3.0/kissy.js'></script>
</head>
<style>	
	.barrel {
			-webkit-transform-style: preserve-3d;
		 position:relative;
		 /*-webkit-perspective:600px;*/
		 -webkit-backface-visibility:hidden;
		 left:500px;
		 top:100px;
		 -webkit-transform:rotateX(0deg) rotateY(0deg) rotateZ(0deg);
		 /*outline:1px solid green;*/
	}
	
	.plane,.cover {
			position:absolute;
			left:50%;
			-webkit-backface-visibility:visible;
			/*
			-webkit-transform-style: preserve-3d;
			-webkit-backface-visibility:visible;
			*/
	}
	.cover {
		left:0;
	}
	</style>
<body>
	<p>
		credits to : http://www.keithclark.co.uk/labs/css3-fps/
	</p>
	<p>
		<label>
			rotateX: <input type='range' max='360' min='-360' step='1' value='0' id='rotateX'/>	
		</label>
	</p>
	
	<p>
		<label>
			rotateY: <input type='range' max='360' min='-360' step='1' value='0' id='rotateY'/>	
		</label>
	</p>
	
	<p>
		<label>
			rotateZ: <input type='range' max='360' min='-360' step='1' value='0' id='rotateZ'/>	
		</label>
	</p>
	
	<div class='barrel'>
	</div>
	
	<script>
		
		var $=KISSY.all, S=KISSY;
		
		var barrel=$('.barrel');
		
		var diameter = 100;
		var r = diameter/2;
		var height =196;
		var sides=20;
		var coverSize=100;
		
		barrel.css({
			'width':diameter,
			'height':height
		});
		
		var planeTpl="<div class='plane {cls}' style='"+
		"background:url(drum.png) {bx}px {by}px;"+
		"width: {w}px;"+
		"margin-left: {ml}px;"+
		"height: {h}px;"+
		"-webkit-transform: translate3d({tx}px,{ty}px,{tz}px)"+
		"rotateX({rx}rad) rotateY({ry}rad) rotateZ({rz}rad)"+
		"'></div>";
		
		function createPlane(config){				
				return $(S.substitute(planeTpl,config));
		}		
		
		function createBarrel(){
			
				barrel.append(createPlane({
					w:100,
					cls:'cover',
					h:100,
					bx:0,
					by:100,
					tx:0,
					ty:-coverSize/2,
					tz:0,
					rx:Math.PI/2,
					ry:0,
					rz:0
				}));
				
				barrel.append(createPlane({
					w:100,
					cls:'cover',
					h:100,
					bx:0,
					by:100,
					tx:0,
					ty:height-coverSize/2,
					tz:0,
					rx:-Math.PI/2,
					ry:0,
					rz:0
				}));
				
				var sideAngle=2*Math.PI/sides;
				var sideLen=2*r*Math.tan(sideAngle/2);
				for(var i = 0; i < sides; i++){
					// center
					var tx = Math.sin(sideAngle*i)*r;
					var tz=Math.cos(sideAngle*i)*r;
					var ry=Math.atan2(tx,tz);
					barrel.append(createPlane({
						// fill little gap
						w:sideLen,
						cls:'',
						ml:-sideLen/2,
						h:196,
						bx:sideLen*i,
						by:0,
						// transform does not recognize 1e-9 science representation
						tx:tx.toFixed(2),
						ty:0,
						tz:tz.toFixed(2),
						rx:0,
						rz:0,
						ry:ry.toFixed(2)
					}));			
				}				
		}
		
		createBarrel();
		
		var rotateX = $('#rotateX');		
		var rotateY = $('#rotateY');		
		var rotateZ = $('#rotateZ');		
		
		S.each([rotateX,rotateY,rotateZ],function(rotate){
			rotate.on('change',function(){			
				barrel.css('-webkit-transform','rotateX('+rotateX.val()+'deg)'+
				'rotateY('+rotateY.val()+'deg)'+'rotateZ('+rotateZ.val()+'deg)');
			});	
		});
		
	</script>
	
</body>
</html>