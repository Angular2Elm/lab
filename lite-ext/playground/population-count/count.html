<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<title>
			编程之美－种群计数
		</title>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<link rel="stylesheet" type="text /css" href="../../base/css/core.css" />
		<script type="text/javascript" src="../../base/javascript/ext-core-min.js">
</script>
		<style type="text/css">
/*<![CDATA[*/

		#single_result,#mul_result {
		margin:10px 0;
		font-weight:bold;
		}
		h1 {
			margin:10px 0;
			font-size:30px;
		}
#wrap {
	width:800px;
	margin:20px auto;
}

		/*]]>*/
		</style>
	</head>
	<body>
		<div id="wrap">
			<h1>
				单个计算数字二进制中 1 的个数
			</h1>
			<p>
				<label>输入单个整数 : <input id="single" /></label> 
				
				<input type="button" id="single_action" value="计算单个整数二进制含1个数" />
			</p>
			<p id="single_result"></p>
			<hr style="margin: 30px 0;" />
			<h1>
				多个计算数字二进制中 1 的个数
			</h1>
			<p>
				<label>输入多个整数(,号分离) : <input id="mul" size="50"/></label> 
				
				<input type="button" id="mul_action" value="计算多个整数二进制含1个数" />
			</p>
			<p id="mul_result"></p>
		</div>
		
		
		
		<script type="text/javascript">
			Ext.onReady(function(){
				
				/*
				计算 x 中 1的个数
				*/
				function popOne(x){
						x = (x & 0x55555555) + ((x >> 1) & 0x55555555);
						x = (x & 0x33333333) + ((x >> 2) & 0x33333333);
						x = (x & 0x0F0F0F0F) + ((x >> 4) & 0x0F0F0F0F);
						x = (x & 0x00FF00FF) + ((x >> 8) & 0x00FF00FF);
						x = (x & 0x0000FFFF) + ((x >> 16) & 0x0000FFFF);
						return x;
				}
				
				/*
				计算 a + b+ c的二进制结果表示.
				
				@return 
				l表示二进制相加每位结果的低位
				h表示二进制相加每位结果的高位位
				*/
				function CSA(a,b,c){
					var u = a ^ b; 
					var v = c; 
					h = (a & b) | (u & v); 
					l = u ^ v;
					return {
						h:h,
						l:l
					}
				}
				
				
				/*
					计算整数数组中所有数字包含 1 个数
				*/
				function popArray(A){
					var n=A.length;
					var  tot = 0,ones = 0;
					var twos=0; 
					for (var i = 0; i <= n - 2; i = i + 2) {
					var step=CSA(ones, A[i], A[i+1]) ;
					//获得高位
					twos=step.h;
					//获得低位
					ones=step.l;
					//高位立即加，低位累进
					tot = tot + popOne(twos);
					} 
					//注意所有高位的要 *2
					tot = 2*tot + popOne(ones); 
					// If there's a last one, 
					// add it in.
					if (n & 1)
					tot = tot + popOne(A[i]); 
					return tot;
					
				}
			
				Ext.get("single_action").on("click",function(){
					var x=parseInt(Ext.get("single").dom.value);
					if(isNaN(x)){
						alert("请输入整数");
						return;
					}
					Ext.get("single_result").update(x.toString(2)+"<br/>1 总数 : "+popOne(x));
					
				});
				
				
				
				Ext.get("mul_action").on("click",function(){
					var x=Ext.get("mul").dom.value.split(/,/);
					var r=[];
					var d=[];
					for(var i=0;i<x.length;i++)
					{
						var ri=parseInt(x[i]);
						if(isNaN(ri)){
							alert("请输入整数");
							return;
						}
						r.push(ri);
						d.push(ri.toString(2));
					}
					Ext.get("mul_result").update(d+"<br/>1 总数 : "+popArray(r));
					
				});
				
			});
		</script>
	
	</body>
</html>
