<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<title>
			代码之美 － 多维矩阵迭代器
		</title>
		<script type="text/javascript" src="../../base/javascript/ext-core-min.js"></script>
		<link rel="stylesheet" type="text/css" href="../../base/css/core.css" />
		<style type="text/css">
		#wrap {
			width:800px;
			margin:20px auto;
		}
		</style>
	</head>
	<body>
		<div id="wrap">
		<form>
			<p>
				<label>输入数组定义<textarea cols="60" rows="11" id="matrix">
					[   [ 
					       [1,2,3] ,
					       [4,5,6],
					       [7,8,9] 
					     ],
					     [ 
					       [11,12,13] ,
					       [14,15,16] 
					     ]
					]
				</textarea></label>
			</p>
			
			<p>
				<label>输入数组传统维数定义<textarea cols="60" rows="13" id="dimRange">
					[{
						start:0,
						end:1       //第一维最长2
					},
					{
						start:0,
						end:2       //第二维最长3
					},
					{
						start:1,     //从1开始，0忽略
						end:2       //第三维最长3
					}
					]
				</textarea></label>
			</p>
			<p>
				<input type="button" value="开始测试" id="test"/>
				</p>
				结果：
				<p style="margin:20px 0;border:1px solid green;" id="result">
					</p>
		</form>
			</div>
	<script type="text/javascript">
	function matrixIter(dimRange,matrix){
		this.dim=dimRange.length-1;
		this.dimRange=dimRange;
		this.counter=[];
		for(var i=0;i<=this.dim;i++){
			this.counter.push(this.dimRange[i].start||0);
		}
		this.counter[this.dim]=(this.dimRange[this.dim].start||0)-1;
		this.matrix=matrix;
	}
	
	matrixIter.prototype.get = function(){
		var item;
		var all=this.matrix;
		for(var i=0;i<this.counter.length;i++){
			item=all[this.counter[i]];
			if(!item) return;
			all=item;
		}
		return item;
	}
	
	matrixIter.prototype.next = function(){
		var curDim=this.dim;
		var item;
		do{
			while(curDim>=0){
				if(this.counter[curDim]<this.dimRange[curDim].end) {
					this.counter[curDim]++;
					break;
				}else{
					this.counter[curDim]=this.dimRange[curDim].start;
					curDim--;
				}
			}
			
			if(curDim<0) break;
		}while(!(item=this.get()));
		
		return item;
	}
	
	
	Ext.onReady(function(){
	
		Ext.get("test").on("click",function(){
			var matrix=eval('('+Ext.get("matrix").dom.value.trim()+')');
			var dimRange=eval('('+Ext.get("dimRange").dom.value.trim()+')');
			var iter=new matrixIter(dimRange,matrix);
			var item;
			var re=[];
			while(item=iter.next()){
				re.push(item);
			}
			Ext.get("result").update(re.join(","));
		})
		
		
	});
	</script>
	</body>
</html>
